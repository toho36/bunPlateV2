#!/bin/sh

# Pre-commit hook to enforce project structure and code quality
# This hook runs before each commit to ensure code quality standards

echo "ðŸ” Running pre-commit checks..."

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Function to print colored output
print_error() {
    echo "${RED}âŒ $1${NC}"
}

print_success() {
    echo "${GREEN}âœ… $1${NC}"
}

print_warning() {
    echo "${YELLOW}âš ï¸  $1${NC}"
}

print_info() {
    echo "â„¹ï¸  $1"
}

# Check if bun is available
if ! command -v bun &> /dev/null; then
    print_error "Bun is not installed. Please install Bun first."
    exit 1
fi

# Run comprehensive pre-push checks
print_info "Running comprehensive pre-commit checks..."
if ! bun run pre-push --skip-git > /dev/null 2>&1; then
    print_error "Pre-commit checks failed!"
    echo ""
    echo "To see detailed errors, run:"
    echo "  bun run pre-push"
    echo ""
    echo "To auto-fix issues, run:"
    echo "  bun run pre-push --fix"
    echo ""
    ERRORS=1
else
    print_success "All pre-commit checks passed"
fi

# Final result
echo ""
if [ $ERRORS -eq 0 ]; then
    print_success "All pre-commit checks passed! ðŸŽ‰"
    echo "Commit proceeding..."
    exit 0
else
    print_error "Pre-commit checks failed!"
    echo ""
    echo "ðŸ“š Helpful commands:"
    echo "  bun run type-check     - Check TypeScript types"
    echo "  bun run lint          - Check code quality"
    echo "  bun run lint:fix      - Auto-fix ESLint errors"
    echo "  bun run format        - Fix code formatting"
    echo "  bun run validate-structure - Check project structure"
    echo "  bun run check-all     - Run all checks at once"
    echo ""
    echo "ðŸ’¡ Fix the issues above and try committing again."
    exit 1
fi